@prefix ex: <https://www.bgee.org/sparql/.well-known/sparql-examples/> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix schema: <https://schema.org/> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix w3: <http://www.w3.org/2000/01/rdf-schema#> .

ex:2_Manual_Mapping_Lyme_sources a sh:SPARQLExecutable,
        sh:SPARQLSelectExecutable ;
    rdfs:comment "Generate manual mapping for Lyme from ORDO, MONDO, EFO and DOID"@en ;
    sh:prefixes _:sparql_examples_prefixes ;
    sh:select """
    PREFIX EFO: <http://www.ebi.ac.uk/efo/EFO_>
PREFIX efo: <http://www.ebi.ac.uk/efo/>
PREFIX oboInOwl: <http://www.geneontology.org/formats/oboInOwl#>
PREFIX obo: <http://purl.obolibrary.org/obo/>
PREFIX ORDO: <http://www.orpha.net/ORDO/>

CONSTRUCT {
  obo:MONDO_0019632 oboInOwl:hasDbXref ?xrefMondo .
  ORDO:Orphanet_91546 oboInOwl:hasDbXref ?xrefOrdo .
  obo:DOID_11729 oboInOwl:hasDbXref ?xrefDoid .
  efo:EFO_0008510 oboInOwl:hasDbXref ?xrefEfo .
}
WHERE {
  {
    obo:MONDO_0019632 oboInOwl:hasDbXref ?xref .
    BIND(
        IF(
          CONTAINS(STR(?xref), "Orphanet"),
          IRI(CONCAT("http://www.orpha.net/ORDO/", ENCODE_FOR_URI(REPLACE(STR(?xref), "^.*Orphanet:", "Orphanet_")))),
          
          IF(
    		UCASE(STRBEFORE(?xref, ":")) = "MESH" || UCASE(STRBEFORE(?xref, ":")) = "ICD10CM",
            IRI(CONCAT("http://purl.bioontology.org/ontology/", UCASE(STRBEFORE(?xref, ":")), "/", ENCODE_FOR_URI(STRAFTER(?xref, ":")))),
            IF(
              CONTAINS(?xref, "ICD9"),
              IRI(CONCAT("http://purl.bioontology.org/ontology/ICD9CM/", ENCODE_FOR_URI(REPLACE(?xref, "路*ICD9:", "")))),
              IF(
                  CONTAINS(?xref, "EFO"),
                  IRI(CONCAT("http://www.ebi.ac.uk/efo/", ENCODE_FOR_URI(REPLACE(?xref, "路*:", "_")))),       
                  IRI(CONCAT("http://example.org/xref/", ENCODE_FOR_URI(?xref)))
                        )))
        ) AS ?xrefMondo
      )
  }
  UNION
  {
    ORDO:Orphanet_91546 oboInOwl:hasDbXref ?xref .
   
    BIND(IF(
          CONTAINS(LCASE(?xref), "mesh"),
          IRI(CONCAT("http://purl.bioontology.org/ontology/MESH/", ENCODE_FOR_URI(REPLACE(?xref, "路*MeSH:", "")))),
          IF(
            CONTAINS(?xref, "ICD-10"),
            IRI(CONCAT("http://purl.bioontology.org/ontology/ICD10CM/", ENCODE_FOR_URI(REPLACE(?xref, "^.*ICD-10:", "")))),
            IRI(CONCAT("http://example.org/xref/", ENCODE_FOR_URI(?xref)))
          )
        ) AS ?xrefOrdo)

  }
  UNION
    {
     	obo:DOID_11729 oboInOwl:hasDbXref ?xref .
        BIND(IF(
              CONTAINS(LCASE(?xref), "mesh"),
              IRI(CONCAT("http://purl.bioontology.org/ontology/MESH/", ENCODE_FOR_URI(REPLACE(?xref, "路*MESH:", "")))),
               IF(
                CONTAINS(?xref, "ICD10CM"),
                IRI(CONCAT("http://purl.bioontology.org/ontology/ICD10CM/", ENCODE_FOR_URI(REPLACE(?xref, "^.*ICD10CM:", "")))),
                IRI(CONCAT("http://example.org/xref/", ENCODE_FOR_URI(?xref)))
          )
            )
 AS ?xrefDoid)

    }
  UNION
    {
        efo:EFO_0008510 oboInOwl:hasDbXref ?xref .
        BIND(IRI(CONCAT("http://example.org/xref/", ENCODE_FOR_URI(?xref))) AS ?xrefEfo)
    }
}
""" ;
    schema:target <https://www.orpha.net/sparql> .


